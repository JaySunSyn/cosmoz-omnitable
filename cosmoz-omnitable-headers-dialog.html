<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html"/>

<link rel="import" href="cosmoz-omnitable-repeater-behavior.html">
<!--
`cosmoz-omnitable-headers-dialog` is an element for displaying omnitable column headers in a separate dialog.

    <cosmoz-dialog>
		<template>
			<cosmoz-omnitable-headers-dialog
				columns="[[disabledColumns]]">
			</cosmoz-omnitable-headers-dialog>
		</template>
	</cosmoz-dialog>

In the above example, the `<cosmoz-omnitable-headers-dialog>` element is wrapped
with a `cosmoz-dialog` element which enables it to be displayed as a dialog.

@group Cosmoz Elements
@element cosmoz-omnitable-headers-dialog
@demo demo/index.html
-->
<dom-module id="cosmoz-omnitable-headers-dialog">
	<template>
		<style include="iron-flex">
			:host {
				display: block;
			}
			.container {
				padding: 12px;
				max-height: calc(100vh - 200px);
			}
		</style>
		
		<div class="container layout vertical">
			<slot name="header-cell"></slot>
		</div>
	</template>
	<script>
	(() => {
		'use strict';
		Polymer({
			is: 'cosmoz-omnitable-headers-dialog',

			behaviors: [
				Cosmoz.OmnitableRepeaterBehavior
			],

			_elementType: 'div',

			_slotName: 'header-cell',

			attached() {
				this._observer = Polymer.dom(this).observeNodes(this._onNodesChange);
			},

			_onNodesChange() {
				const accs = Polymer.dom(this).querySelectorAll('paper-autocomplete-chips');
	
				setTimeout(() => {
					accs.forEach(acc => {
						const width = `${acc.offsetWidth}px`,
							position = 'fixed';
	
						if (Polymer.Element) {
							acc.updateStyles({
								'--paper-autocomplete-chips-suggestions-position': position,
								'--paper-autocomplete-chips-suggestions-width': width
							});
							return;
						}
						acc.customStyle['--paper-autocomplete-chips-suggestions-position'] = position;
						acc.customStyle['--paper-autocomplete-chips-suggestions-width'] = width;
						acc.updateStyles();
					});
				});
	
			},

			_getTemplateInstance(column) {
				return column.headerTemplatizer.getInstance();
			},

			_detachTemplateInstance(instance, column, element) {
				column.headerTemplatizer.detachInstance(instance, element);
			},

			_configureTemplateInstance(instance) {
				this._forwardPropertiesFlush(instance);
			}
		});
})();
	</script>
</dom-module>
