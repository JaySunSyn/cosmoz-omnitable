<link rel="import" href="cosmoz-omnitable-column-behavior.html">
<link rel="import" href="../cosmoz-autocomplete/cosmoz-autocomplete.html">

<dom-module id="cosmoz-omnitable-column-autocomplete">
	<template>

		<cosmoz-omnitable-templatizer id="data-templatizer">
			<template><span class="default-column">[[renderDefaultValue(item, valuePath)]]</span></template>
		</cosmoz-omnitable-templatizer>

		<cosmoz-omnitable-templatizer id="edit-data-templatizer">
			<template>
				<paper-input no-label-float type="text" on-change="_valueChanged" value="[[renderDefaultValue(item, valuePath)]]"></paper-input>
			</template>
		</cosmoz-omnitable-templatizer>

		<cosmoz-omnitable-templatizer id="header-templatizer">
			<template>
				<cosmoz-autocomplete
					items="[[_autocompleteItems]]"
					placeholder="[[title]]"
					selected-items="{{_autocompleteSelectedItems}}"
					multi-selection
				></cosmoz-autocomplete>
			</template>
		</cosmoz-omnitable-templatizer>

	</template>
	<script>
		Polymer({
			is: 'cosmoz-omnitable-column-autocomplete',

			properties: {
				_autocompleteItems: {
					type: Array,
					notify: true
				},
				_autocompleteSelectedItems: {
					type: Array
				}
			},

			behaviors: [
				Cosmoz.OmnitableColumnBehavior
			],

			created: function () {
				this.bindValues = true;
			},

			observers: [
				'_valuesChanged(values.*)',
				'_autocompleteSelectedItemsChanged(_autocompleteSelectedItems.*)'
			],

			_valuesChanged: function (change) {
				this._autocompleteItems = this.values.map(function (value) {
					return {
						label: value,
						value: value
					};
				});
			},

			_autocompleteSelectedItemsChanged: function (change) {
				this.filter = this._autocompleteSelectedItems.map(function (item) {
					return item.value;
				});
			},


			_applySingleFilter: function (filterString, item) {

				var value = this.get(this.valuePath, item).toString().toLowerCase();

				return value === filterString;
			},

			_applyMultiFilter: function (filterArray, item) {
				var	value = this.get(this.valuePath, item).toString().toLowerCase();

				return filterArray.some(function (filter) {
					return value === filter;
				});
			}
		});

	</script>
</dom-module>
