<link rel="import" href="../paper-spinner/paper-spinner-lite.html">
<link rel="import" href="../paper-autocomplete-chips/paper-autocomplete-chips.html">

<link rel="import" href="cosmoz-omnitable-column-behavior.html">

<dom-module id="cosmoz-omnitable-column-autocomplete">
	<template>
		<template class="cell">
			<span class="default-column">[[ getString(item, valuePath) ]]</span>
		</template>

		<template class="edit-cell">
			<paper-input no-label-float type="text" on-change="_valueChanged" value="[[ getString(item, valuePath) ]]"></paper-input>
		</template>

		<template class="header">
			<paper-autocomplete-chips
				text="{{ query }}"
				source="[[ values ]]"
				label="[[ title ]]"
				selected-items="{{ filter }}"
				text-property="[[ textProperty ]]"
				value-property="[[ valueProperty ]]">
				<paper-spinner-lite style="width: 20px; height: 20px;" slot="suffix" active="[[ loading ]]" hidden="[[ !loading ]]"></paper-spinner-lite>
			</paper-autocomplete-chips>
		</template>
	</template>

	<script>
		Polymer({
			is: 'cosmoz-omnitable-column-autocomplete',

			behaviors: [
				Cosmoz.OmnitableColumnBehavior
			],

			properties: {
				/**
				 * Ask for a list of values
				 */
				bindValues: {
					type: Boolean,
					readOnly: true,
					value: true
				},

				query: {
					type: String,
					notify: true
				},

				textProperty: {
					type: String,
					value: 'text'
				},

				valueProperty: {
					type: String,
					value: ''
				}
			},

			_getDefaultHeaderCellClass: function () {
				return 'autocomplete-header-cell';
			},

			_applySingleFilter: function (filterString, item) {
				var value = this.get(this.valuePath, item).toString().toLowerCase();
				return value === filterString;
			},

			_applyMultiFilter: function (filterArray, item) {
				var	value = this.get(this.valuePath, item).toString().toLowerCase();
				return filterArray.indexOf(value) !== -1;
			}
		});
	</script>
</dom-module>
