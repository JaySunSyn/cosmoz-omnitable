<link rel="import" href="cosmoz-omnitable-column-behavior.html">
<link rel="import" href="../cosmoz-autocomplete/cosmoz-autocomplete.html">

<dom-module id="cosmoz-omnitable-column-autocomplete">
	<template>
		<template id="data-template">
			<span class="default-column">[[ getString(item, valuePath) ]]</span>
		</template>

		<template id="edit-data-template">
			<paper-input no-label-float type="text" on-change="_valueChanged" value="[[ getString(item, valuePath) ]]"></paper-input>
		</template>

		<template id="header-template">
			<cosmoz-autocomplete
				input-value="{{ query }}"
				items="[[ values ]]"
				loading="[[ loading ]]"
				value-property=""
				placeholder="[[ title ]]"
				selected-items="{{ filter }}"
				multi-selection
			></cosmoz-autocomplete>
		</template>
	</template>

	<script>
		Polymer({
			is: 'cosmoz-omnitable-column-autocomplete',

			behaviors: [
				Cosmoz.OmnitableColumnBehavior
			],

			properties: {
				/**
				 * Ask for a list of values
				 */
				bindValues: {
					type: Boolean,
					readOnly: true,
					value: true
				},

				query: {
					type: String,
					notify: true
				}
			},

			_getDefaultHeaderCellClass: function () {
				return 'autocomplete-header-cell';
			},

			_applySingleFilter: function (filterString, item) {
				var value = this.get(this.valuePath, item).toString().toLowerCase();
				return value === filterString;
			},

			_applyMultiFilter: function (filterArray, item) {
				var	value = this.get(this.valuePath, item).toString().toLowerCase();
				return filterArray.indexOf(value) !== -1;
			}
		});
	</script>
</dom-module>
