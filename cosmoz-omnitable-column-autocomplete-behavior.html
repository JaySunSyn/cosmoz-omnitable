<link rel="import" href="../cosmoz-autocomplete/cosmoz-autocomplete.html">
<script>

	if (typeof Cosmoz === 'undefined') {
		var Cosmoz = {};
	}

	/** @polymerBehavior */
	Cosmoz.OmnitableColumnAutocompleteBehavior = {
		properties: {
			autocompleteItems: {
				type: Array,
				notify: true,
				computed: '_computeAutocompleteItems(values.*)'
			},
			autocompleteSelectedItems: {
				type: Array
			},
			/**
			 * Ask for a list of values
			 */
			bindValues: {
				type: Boolean,
				readOnly: true,
				value: true
			},
		},

		observers: [
			'_autocompleteSelectedItemsChanged(autocompleteSelectedItems.*)'
		],

		_computeAutocompleteItems: function (change) {
			return change.base
				.filter(function (value, index, array) {
					// Make the item list unique
					return array.indexOf(value) === index;
				})
				.map(function (value) {
					return {
						value: value,
						label: this._getLabelForValue(value)
					};
				}, this);
		},

		_getLabelForValue: function (value) {
			return value.toString();
		},

		_autocompleteSelectedItemsChanged: function (change) {
			this.filter = this.autocompleteSelectedItems.map(function (item) {
				return item.value;
			});
		},

		_applySingleFilter: function (filterString, item) {
			var value = this.get(this.valuePath, item).toString().toLowerCase();
			return value === filterString;
		},

		_applyMultiFilter: function (filterArray, item) {
			var	value = this.get(this.valuePath, item).toString().toLowerCase();

			return filterArray.some(function (filter) {
				return value === filter;
			});
		}
	};
</script>
