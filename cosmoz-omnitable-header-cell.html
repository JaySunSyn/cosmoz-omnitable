<link rel="import" href="../iron-flex-layout/iron-flex-layout.html"/>

<dom-module id="cosmoz-omnitable-header-cell">
	<template>
		<style>
			:host {
				flex: 1 0 auto;
				padding: 0 3px;
				white-space: nowrap;
				text-overflow: ellipsis;
				@apply --layout-horizontal;
				@apply --layout-center;
			}
			::slotted(*) {
				@apply --layout-flex;
			}
		</style>
		<slot></slot>
	</template>
	<script>
		Polymer({
			is: 'cosmoz-omnitable-header-cell',
			properties: {

				column: {
					type: Object,
					observer: '_columnChanged'
				}
			},

			// WARN: do not use '_templateInstance' property name, as this will conflict with
			// a property used by Templatizer

			_headerTemplateInstance: null,

			_columnChanged: function (newColumn, oldColumn) {
				if (oldColumn && oldColumn.headerCellClass) {
					this.toggleClass(oldColumn.headerCellClass, false);
				}
				if (newColumn) {
					var oldTemplateInstance = this._headerTemplateInstance,
						newTemplateInstance = newColumn.getHeaderTemplateInstance();
					if (!newTemplateInstance) {
						return;
					}
					this._updateTemplate(newTemplateInstance, oldTemplateInstance);
					if (newColumn.headerCellClass) {
						this.toggleClass(newColumn.headerCellClass, true);
					}
				}
			},

			_updateTemplate: function (newTemplateInstance, oldTemplateInstance) {
				var parent = Polymer.dom(this),
					children = parent.childNodes,
					i;

				// Remove current content
				if (children) {
					for (i = 0 ; i < children.length ; i+=1) {
						parent.removeChild(children[i]);
					}
				}

				if (newTemplateInstance) {
					Polymer.dom(this).appendChild(newTemplateInstance.root);
					this._headerTemplateInstance = newTemplateInstance;
					// HACK(pasleq): remove column style scope and set style scope from omnitable
					if (!Polymer.Settings.useNativeShadow) {
						Polymer.StyleTransformer.dom(this, this.column.is, false, true);
						Polymer.StyleTransformer.dom(this, 'cosmoz-omnitable', false, false);
					}
				} else {
					this._cellTemplateInstance = null;
				}
			}
		});
	</script>
</dom-module>
