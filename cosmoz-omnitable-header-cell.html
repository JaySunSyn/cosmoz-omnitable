<link rel="import" href="../iron-flex-layout/iron-flex-layout.html"/>

<dom-module id="cosmoz-omnitable-header-cell">
	<template>
		<style>
			:host {
				flex: 1 0 auto;
				padding: 0 3px;
				white-space: nowrap;
				text-overflow: ellipsis;
				@apply --layout-horizontal;
				@apply --layout-center;
			}
			::slotted(*) {
				@apply --layout-flex;
			}
		</style>
		<slot></slot>
	</template>
	<script>
		Polymer({
			is: 'cosmoz-omnitable-header-cell',
			properties: {

				column: {
					type: Object,
					observer: '_columnChanged'
				},
			},

			_columnChanged: function (newColumn, oldColumn) {
				if (oldColumn) {
					if (oldColumn.headerCellClass) {
						this.toggleClass(oldColumn.headerCellClass, false);
					}
					oldColumn.releaseCells();
				}

				if (newColumn) {
					if (newColumn.headerCellClass) {
						this.toggleClass(newColumn.headerCellClass, true);
					}

					newColumn.releaseCells();
					newColumn.setHeaderCell(this);
					var templateInstance = newColumn.getHeaderTemplateInstance();
					Polymer.dom(this).appendChild(templateInstance.root);

					// HACK(pasleq): remove column style scope and set style scope from omnitable
					if (!Polymer.Settings.useNativeShadow) {
						Polymer.StyleTransformer.dom(this, this.column.is, false, true);
						Polymer.StyleTransformer.dom(this, 'cosmoz-omnitable', false, false);
					}
				}
			},

			clearContent: function () {
				var parent = Polymer.dom(this),
					children = parent.childNodes,
					i;
				if (children) {
					for (i = 0 ; i < children.length ; i+=1) {
						parent.removeChild(children[i]);
					}
				}
			},

		});
	</script>
</dom-module>
