<dom-module id="cosmoz-omnitable-header-cell">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>
		<content></content>
	</template>
	<script>
		Polymer({
			is: 'cosmoz-omnitable-header-cell',
			properties: {

				column: {
					type: Object
				}
			},

			observers: [
				'_columnChanged(column)'
			],

			// WARN: do not use '_templateInstance' property name, as this will conflict with
			// a property used by Templatizer

			_headerTemplateInstance: null,

			_columnChanged: function (newColumn, oldColumn) {
				var oldTemplateInstance;

				if (oldColumn && oldColumn.headerCellClass) {
					this.toggleClass(oldColumn.headerCellClass, false);
				}
				if (newColumn) {
					oldTemplateInstance = this._headerTemplateInstance;
					this._updateTemplate(newColumn.getHeaderTemplateInstance(), oldTemplateInstance);
					if (newColumn.headerCellClass) {
						this.toggleClass(newColumn.headerCellClass, true);
					}
				}
			},

			_updateTemplate: function (newTemplateInstance, oldTemplateInstance) {
				var children, parent, i;

				// Remove current content
				parent = Polymer.dom(this);
				children = parent.childNodes;
				if (children) {
					for (i = 0 ; i < children.length ; i+=1) {
						parent.removeChild(children[i]);
					}
				}

				if (newTemplateInstance) {
					Polymer.dom(this).appendChild(newTemplateInstance.root);
					this._headerTemplateInstance = newTemplateInstance;
					// HACK(pasleq): remove column style scope and set style scope from omnitable
					if (!Polymer.Settings.useNativeShadow) {
						Polymer.StyleTransformer.dom(this, this.column.is, false, true);
						Polymer.StyleTransformer.dom(this, 'cosmoz-omnitable', false, false);
					}
				} else {
					this._cellTemplateInstance = null;
				}
			}
		});
	</script>
</dom-module>
