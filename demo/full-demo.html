<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Cosmoz Omnitable demo</title>

	<script src="../../webcomponentsjs/webcomponents-lite.js"></script>
	<link rel="import" href="../../polymer/polymer.html">
	<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
	<link rel="import" href="../../iron-flex-layout/iron-flex-layout-classes.html">
	<link rel="import" href="../../iron-icons/editor-icons.html">
	<link rel="import" href="../../iron-icons/iron-icons.html">
	<link rel="import" href="../../paper-button/paper-button.html">
	<link rel="import" href="../../cosmoz-i18next/cosmoz-i18next.html">
	<link rel="import" href="../cosmoz-omnitable.html">

	<link rel="import" href="table-demo-behavior.html">

	<style is="custom-style" include="iron-flex iron-flex-alignment iron-positioning">

	</style>

</head>
<body class="fullbleed">
	<dom-module id="x-page">
		<template>
			<style include="iron-flex iron-positioning">
				:host {
					display: block;
					position: relative;
				}

				.action {
					padding: 5px;
					margin: 5px 5px 10px 5px;
				}
			</style>
			<div class="layout vertical fit">
				<h3>Cosmoz omnitable demo</h3>
				<div class="layout horizontal center">
					<button class="action" on-tap="changeData">Generate a new data set</button>
					<div class="action">
						Selected items count: <span>{{selectedItems.length}}</span>
					</div>
				</div>
				<cosmoz-omnitable data="[[data]]" class="flex" selection-enabled selected-items="{{selectedItems}}" group-on="group">
					<header id="id">Id</header>
					<header id="name">Name</header>
					<header id="randomString">Random string</header>
					<header id="randomString2">Random string 2</header>
					<header id="randomString3">Random string 3</header>
					<header id="randomString4">Random string 4</header>
					<header id="amount" type="amount" range-select="false">Amount</header>
					<header id="date" type="date" render-func="Cosmoz.formatDate">Date</header>
					<header id="group">Group</header>
					<paper-button action on-run="updateSelectedRow">
						<iron-icon icon="editor:mode-edit"></iron-icon>
						<span>{{ _computeLabel('Update', selectedItems.length)}}</span>
					</paper-button>
					<paper-button action on-run="removeItems">
						<iron-icon icon="delete"></iron-icon>
						<span>{{ _computeLabel('Remove', selectedItems.length)}}</span>
					</paper-button>
				</cosmoz-omnitable>
			</div>
		</template>
	</dom-module>

	<x-page class="fit"></x-page>

	<script type="text/javascript">
/*global document, window, Cosmoz, Polymer */
(function () {
	'use strict';


	Polymer({
		is: 'x-page',

		properties: {
			data: {
				type: Array
			},
			selectedItems: {
				type: Array
			}
		},

		behaviors: [
			Cosmoz.TableDemoBehavior
		],

		attached: function () {
			this.changeData();
		},

		changeData: function () {
			this.data = this.generateTableDemoData(20,25);
		},

		_computeLabel: function (text, count) {
			return text + ' ' + count + ' items';
		},

		updateSelectedRow: function (event, detail) {
			var branchId = detail.items[0].id,
				arrayPosition = -1;

			this.data.some(function (element, index) {
				if (branchId === element.id) {
					arrayPosition = index;
					return true;
				}
			});

			this.set('data.' + arrayPosition.toString() + '.randomString3', 'blablablalbal');
		},

		removeItems: function (event, detail) {
			console.log('runAction', detail.items, event, detail, detail.items);
			detail.omnitable.removeItems(detail.items);
		},

		renderAmount: function (money) {
			return money.amount + ' ' + money.currency;
		},

		filterAmount: function (money, filter) {
			var fromValue = parseInt(filter.fromValue, 10),
				toValue = parseInt(filter.toValue, 10);
			return money.amount < fromValue || money.amount > toValue;
		}
	});
}());

	</script>
</body>
</html>