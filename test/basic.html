<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	<title>cosmoz-omnitable basic test</title>
	<script type="text/javascript">
	var logStore = [],
		errorStore = [],
		warnStore = [],
		oldLogFunc = console.log,
		oldErrorFunc = console.error,
		oldWarnFunc = console.warn;

	console.log = function (logMessage) {
		logStore.push(logMessage);
		oldLogFunc.apply(console, arguments);
	};

	console.error = function (errorMessage) {
		errorStore.push(errorMessage);
		oldErrorFunc.apply(console, arguments);
	};

	console.warn = function (warnMessage) {
		warnStore.push(warnMessage);
		oldWarnFunc.apply(console, arguments);
	};

	</script>
	<script src="../../web-component-tester/browser.js"></script>
	<script src="../../webcomponentsjs/webcomponents-lite.js"></script>

	<link rel="import" href="../cosmoz-omnitable.html">
	<link rel="import" href="../cosmoz-omnitable-columns.html">
	<link rel="import" href="../demo/table-demo-behavior.html">
</head>
<body>
	<test-fixture id="cosmoz-omnitable-fixture">
		<template>
			<cosmoz-omnitable></cosmoz-omnitable>
		</template>
	</test-fixture>

	<test-fixture id="cosmoz-omnitable-column-setup">
		<template>
			<cosmoz-omnitable id="omnitable" class="flex" data="[[ data ]]" selection-enabled selected-items="{{ selectedItems }}">
				<cosmoz-omnitable-column-date id="date1" name="date1" value-path="date">
				</cosmoz-omnitable-column-date>
				<cosmoz-omnitable-column-date id="date2" name="date2" value-path="dateJson">
				</cosmoz-omnitable-column-date>
				<cosmoz-omnitable-column-date name="date3" value-path="date">
					</cosmoz-omnitable-column-date>
			</cosmoz-omnitable>
		</template>
	</test-fixture>

	<script>
	/*global logStore, errorStore, warnStore */
	(function () {
		'use strict';

		suite('<cosmoz-omnitable>', function () {
			test('No console logs should exist', function () {
				assert.equal(logStore.length, 0, 'Log messages: ' + logStore.join(' | '));
			});

			test('No console warn should exist', function () {
				assert.equal(warnStore.length, 0, 'Warn messages: ' + warnStore.join(' | '));
			});

			test('No console errors should exist', function () {
				assert.equal(errorStore.length, 0, 'Error messages: ' + errorStore.join(' | '));
			});

		});

		suite('cosmoz-omnitable-column-setup', function () {
			var omnitable,
				data;
	
			setup(function () {
				omnitable = fixture('cosmoz-omnitable-column-setup');
				data = Cosmoz.TableDemoBehavior.generateTableDemoData(10, 11, 25);
				omnitable.data = data;
				// Don't log the name not unique errors
				stub('cosmoz-omnitable', {
					_verifyColumnSetup: function () {
						return true;
					}
				});
			});
	
			test('Update Columns', function () {
				var date1 = omnitable.querySelector('#date1'),
					date2 = omnitable.querySelector('#date2');

				/**
				 * Not existing name attribute.
				 * Test if name set via value-path.
				 */
				date1.name = 'date';
				date1.valuePath = 'date';
				date2.name = '';
				date2.valuePath = 'dateJSON';
				omnitable._updateColumns();
	
				expect(date2.name).to.be.equal(date2.valuePath);
				expect(date1.name).not.to.be.equal(date2.name);

				/**
				 * Not existing name attribute. No unique value-path.
				 * Test if name not set via value-path.
				 */
				date2.name = '';
				date2.valuePath = 'date';
				omnitable._updateColumns();

				expect(date2.name).to.be.equal('');
				expect(date1.name).not.to.be.equal(date2.name);
			});

			test('Retrieve Column', function () {
				var date1 = omnitable.querySelector('#date1'),
					date2 = omnitable.querySelector('#date2'),
					column;

				/**
				 * Test retrieving a column via its name attribute.
				 */
				date1.name = 'date1';
				date2.name = 'date2';
				omnitable._updateColumns();
	
				column = omnitable._getColumn('date1');
				expect(column).to.be.equal(date1);
			});

			test('Visible Columns', function () {
				omnitable._updateColumns();
				/**
				 * Test if visible columns do not include the group on column.
				 */
				omnitable.groupOn = 'date2';
				expect(omnitable.visibleColumns.length).to.be.equal(omnitable.columns.length - 1);
				expect(omnitable.visibleColumns).not.include(omnitable.groupOnColumn);

				/**
				 * Test if all columns are visible if not grouped.
				 */
				omnitable.groupOn = '';
				expect(omnitable.visibleColumns).to.be.deep.equal(omnitable.columns);
			});
		});
	}());

	</script>
</body>
</html>
