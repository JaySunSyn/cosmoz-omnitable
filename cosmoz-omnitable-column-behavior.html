<script>

	if (typeof Cosmoz === 'undefined') {
		var Cosmoz = {};
	}

	/**
	 * @polymerBehavior
	 */
	Cosmoz.OmnitableColumnBehavior = {
		properties: {

			title: {
				type: String
			},

			valuePath: {
				type: String
			},

			dataTemplate: {
				type: Object
			},

			headerTemplate: {
				type: Object
			},

			/**
			 * If true, the column will be editable by using an input element for rendering.
			 */
			editable: {
				type: Boolean
			}

		},

		// WARN: <cosmoz-omnitable-column-*> elements are used only as column definition elements,
		// and are not distributed in omnitable DOM. Thus, the attached/detached callbacks
		// are not called on these elements, and one should not rely on these callbacks.
		// See https://github.com/Polymer/polymer/issues/1365
		ready: function () {
			this.dataTemplate = this._getDataTemplate();
			this.headerTemplate = this._getHeaderTemplate();
		},

		_getDataTemplate: function () {
			var templateSelector;

			if (this.editable) {
				templateSelector = 'template[id="edit-data-template"]';
			} else {
				templateSelector = 'template[id="data-template"]';
			}

			return this._getTemplate(templateSelector);

		},

		_getHeaderTemplate: function () {
			var selector = 'template[id="header-template"]';
			return this._getTemplate(selector);
		},

		_getTemplate: function (selector) {
			var template = Polymer.dom(this).querySelector(selector);

			if (!template) {
				template = Polymer.dom(this.root).querySelector(selector);
			}

			return template;

		},

		renderDefaultValue: function (item, valuePath) {
			return this.get(valuePath, item);
		},

		_valueChanged: function (event) {
			var
				input = event.target,
				value = input.value,
				item = event.model.item;

			this.set(this.valuePath, value, item);
		}

	};

</script>
